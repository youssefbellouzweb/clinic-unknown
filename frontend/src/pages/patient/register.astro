---
import Layout from "../../layouts/Layout.astro";
---

<Layout title="Patient Registration - ClinicHub">
    <div
        class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8"
    >
        <div
            class="max-w-md w-full space-y-8 bg-white p-8 rounded-xl shadow-lg"
        >
            <div>
                <h2
                    class="mt-6 text-center text-3xl font-extrabold text-gray-900"
                >
                    Create Patient Account
                </h2>
                <p class="mt-2 text-center text-sm text-gray-600">
                    Register to access your medical records
                </p>
            </div>

            <form class="mt-8 space-y-6" id="registerForm">
                <div class="space-y-4">
                    <div>
                        <label
                            for="name"
                            class="block text-sm font-medium text-gray-700"
                            >Full Name</label
                        >
                        <input
                            id="name"
                            name="name"
                            type="text"
                            required
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="John Doe"
                        />
                    </div>

                    <div>
                        <label
                            for="email"
                            class="block text-sm font-medium text-gray-700"
                            >Email</label
                        >
                        <input
                            id="email"
                            name="email"
                            type="email"
                            required
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="john@example.com"
                        />
                    </div>

                    <div>
                        <label
                            for="phone"
                            class="block text-sm font-medium text-gray-700"
                            >Phone</label
                        >
                        <input
                            id="phone"
                            name="phone"
                            type="tel"
                            required
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="+1234567890"
                        />
                    </div>

                    <div>
                        <label
                            for="date_of_birth"
                            class="block text-sm font-medium text-gray-700"
                            >Date of Birth</label
                        >
                        <input
                            id="date_of_birth"
                            name="date_of_birth"
                            type="date"
                            required
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                        />
                    </div>

                    <div>
                        <label
                            for="password"
                            class="block text-sm font-medium text-gray-700"
                            >Password</label
                        >
                        <input
                            id="password"
                            name="password"
                            type="password"
                            required
                            minlength="6"
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="Min. 6 characters"
                        />
                    </div>

                    <div>
                        <label
                            for="confirm_password"
                            class="block text-sm font-medium text-gray-700"
                            >Confirm Password</label
                        >
                        <input
                            id="confirm_password"
                            name="confirm_password"
                            type="password"
                            required
                            class="mt-1 appearance-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                            placeholder="Confirm password"
                        />
                    </div>
                </div>

                <div>
                    <button
                        type="submit"
                        class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                    >
                        Create Account
                    </button>
                </div>

                <div class="text-center">
                    <p class="text-sm text-gray-600">
                        Already have an account?
                        <a
                            href="/patient/login"
                            class="font-medium text-indigo-600 hover:text-indigo-500"
                        >
                            Sign in
                        </a>
                    </p>
                </div>

                <div id="message" class="hidden mt-4 p-3 rounded"></div>
            </form>
        </div>
    </div>

    <script>
        const form = document.getElementById("registerForm");
        const messageDiv = document.getElementById("message");

        form?.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const password = formData.get("password");
            const confirmPassword = formData.get("confirm_password");

            if (password !== confirmPassword) {
                messageDiv.textContent = "Passwords do not match";
                messageDiv.className =
                    "mt-4 p-3 rounded bg-red-100 text-red-700";
                messageDiv.classList.remove("hidden");
                return;
            }

            const data = {
                name: formData.get("name"),
                email: formData.get("email"),
                phone: formData.get("phone"),
                date_of_birth: formData.get("date_of_birth"),
                password: password,
            };

            try {
                const response = await fetch(
                    "http://localhost:5000/api/patient-portal/register",
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(data),
                    },
                );

                const result = await response.json();

                if (response.ok) {
                    messageDiv.textContent =
                        "Registration successful! Redirecting to login...";
                    messageDiv.className =
                        "mt-4 p-3 rounded bg-green-100 text-green-700";
                    messageDiv.classList.remove("hidden");
                    setTimeout(
                        () => (window.location.href = "/patient/login"),
                        2000,
                    );
                } else {
                    messageDiv.textContent =
                        result.error || "Registration failed";
                    messageDiv.className =
                        "mt-4 p-3 rounded bg-red-100 text-red-700";
                    messageDiv.classList.remove("hidden");
                }
            } catch (error) {
                messageDiv.textContent = "Connection error. Please try again.";
                messageDiv.className =
                    "mt-4 p-3 rounded bg-red-100 text-red-700";
                messageDiv.classList.remove("hidden");
            }
        });
    </script>
</Layout>
